**1. 问题诊断**
*   **关于“data目录”提示**：您在 `Terminal#232-415` 看到的提示可能是旧的 `echo` 语句或被注释掉的代码。虽然脚本逻辑中已移除了实际的 `mkdir data` 操作，但可能还有残留的注释或未清理的 echo 文本。我会再次检查并彻底清理。
*   **关于“OIDC 登录不成功”**：
    *   **原因分析**：OIDC 回调地址通常与域名强绑定。之前在 `deploy-from-images.sh` 中部署时，可能没有正确传递 `OIDC_REDIRECT_URI` 等环境变量到 `docker-compose`。在 `docker-compose.yml` 中，后端服务的环境变量列表里并没有包含 OIDC 相关的配置（如 `OIDC_ISSUER_URL`, `OIDC_CLIENT_ID`, `OIDC_REDIRECT_URI` 等）。
    *   **后果**：后端默认使用了代码中的 `localhost:8001` 作为回调地址，这在服务器上是无法访问的，导致登录后无法跳回或报错。
*   **关于“数据库未连接”**：
    *   **原因分析**：虽然 `docker-compose.yml` 添加了 `mysql` 服务，但 `deploy-from-images.sh` 脚本在启动服务前，并没有确保 MySQL 已经完全就绪（虽然有 `depends_on`，但首次初始化可能较慢）。更关键的是，后端连接 MySQL 的环境变量（如 `PROD_DB_HOST`）虽然在 `docker-compose.yml` 中定义了，但如果容器内部网络或权限有问题，连接仍会失败。
    *   **检查点**：需要确认 `deploy-from-images.sh` 是否正确加载了环境变量文件（如果有），或者是否需要用户手动输入这些敏感信息。目前脚本里并没有让用户输入 DB 密码或 OIDC 配置的步骤。

**2. 修复计划**
*   **完善 `deploy-from-images.sh`**：
    *   **清理误导信息**：删除所有关于 `data` 目录的过时 echo 提示。
    *   **增加配置交互**：脚本启动时，检查是否存在 `.env` 文件。如果不存在，提示用户输入关键配置（OIDC 配置、MySQL 密码等），并生成 `.env` 文件。
    *   **加载环境变量**：确保 `docker-compose` 运行时能读取到 `.env` 文件中的配置。
*   **更新 `docker-compose.yml`**：
    *   **透传 OIDC 变量**：在 `backend` 服务的 `environment` 部分，显式添加 OIDC 相关变量（引用自 `.env`）。
    *   **透传 MySQL 变量**：确保 MySQL 的密码等敏感信息也引用自 `.env`，而不是硬编码。
*   **验证数据库连接**：在脚本中增加一步，使用 `docker exec` 进入后端容器测试数据库连接，或者在后端代码中增加更详细的连接失败日志。

**3. 执行步骤**
1.  修改 `docker-compose.yml`，将 OIDC 和数据库配置参数化（使用 `${VAR}` 语法）。
2.  重写 `deploy-from-images.sh`，增加 `.env` 文件生成逻辑和清理旧提示。
3.  （可选）更新后端代码增加连接重试日志（如果之前没加）。

**目标**：确保在服务器执行脚本时，用户能配置正确的域名和密钥，从而解决登录和数据库连接问题。